"use strict";!function(e){var t=typeof e.document,r={},n=[],o=[];r.observable=function(e){var r,o,a=e,i=function(e){if(0===arguments.length)return a;var i=a;if(i instanceof Array?e instanceof Array?a=e:a.push(e):a=e,!r)for(var l=n.length-1;l>=0;l--){var c=n[l];if(c.observable()===a){r=c.key;break}}if("undefined"!==t){var s=document.querySelectorAll("*[data-knity]");if(s)for(var v=s.length-1;v>=0;v--){var d=s[v];-1!==d.getAttribute("data-knity").indexOf(r)&&f(d,a)}}return"function"==typeof o&&o(r,a),{onUpdate:u}},u=function(e){if("function"!=typeof e)throw new Error("callback must be a function");o=e};return i},r.attach=function(e,t,o){if("object"!=typeof e)throw new Error("The view model must be an object");if(!p(t))throw new Error("The View-Model must be attached to a DOM element. "+typeof t+" given");var a;for(a in e)if("function"==typeof e[a]){var f=e[a];f.toString()===r.observable().toString()&&n.push(o?{key:o+"."+a,value:f(),observable:f}:{key:a,value:f(),observable:f})}else"object"==typeof e[a]&&(o?o+="."+a:o=a,r.attach(e[a],t,o),o="");for(var u=t.querySelectorAll("[data-knity]"),l=u.length,c=l-1;c>=0;c--)i(u[c],e)};var a=function(e,t){e.addEventListener("keyup",function(e){var r=e.target,n=r.value;return t()===n?void e.preventDefault():void t(n)})},i=function(e){for(var t,r=e.getAttribute("data-knity").trim(),n=/(?:\s|^)(\w+):\s*(.*?)(?=\s+\w+:|$)/g;t=n.exec(r);){var o=t[1].trim(),i=t[2].trim().replace(",",""),l=u(i);l&&(f(e,l(),e.parentNode),"value"===o&&a(e,l))}},f=function(e,t){for(var r,n=e.getAttribute("data-knity").trim(),o=/(?:\s|^)(\w+):\s*(.*?)(?=\s+\w+:|$)/g;r=o.exec(n);){var a=r[1].trim();if("text"===a)s(e,t);else if("value"===a)v(e,t);else if("placeholder"===a)d(e,t);else if("class"===a)c(e,t);else{if("foreach"!==a)throw new Error("The property: "+a+" is unknown");l(e,t)}}},u=function(e){for(var t=n.length-1;t>=0;t--){var r=n[t];if(r.key===e)return r.observable}return!1},l=function(e,t){if(!(t instanceof Array))throw new Error("The foreach binding only works with arrays, be sure that you correctly instanciated the observable with a valid array. "+typeof t+" is given");for(var r=-1,n=o.length-1;n>=0;n--){var a=o[n];if(a.el.getAttribute("data-knity")===e.getAttribute("data-knity")){r=n;break}}var i="";if(-1===r){var f=e.cloneNode(!0);o.push({el:e,tpl:f.innerHTML}),i=f.innerHTML}else e=o[r].el,i=o[r].tpl;var u=i.match(/\{{2}[ \t]*(.[a-zA-Z0-9_]+)[ \t]*\}{2}/g),l=[],c="";if(null!==u)for(var s=0,v=t.length;v>s;s++){c=i;var d=t[s];for(n=u.length-1;n>=0;n--){var p=u[n],y=p.replace("{{","").replace("}}","").trim();if("#"===y[0]){if(y=y.substr(1),"undefined"==typeof d[y])throw new Error("The variable: "+y+" is not found");d[y]===!0?(c=c.replace(new RegExp("\\{{2}\\#"+y+"\\}{2}([\\s\\S]*?)\\{{2}\\/"+y+"\\}{2}","g"),"$1"),c=c.replace(new RegExp("\\{{2}[ \\t]*(\\^"+y+")[ \\t]*\\}{2}([\\s\\S]*?)\\{{2}[ \\t]*(\\/"+y+")[ \\t]*\\}{2}","g"),"")):(c=c.replace(new RegExp("\\{{2}\\^"+y+"\\}{2}([\\s\\S]*?)\\{{2}\\/"+y+"\\}{2}","g"),"$1"),c=c.replace(new RegExp("\\{{2}[ \\t]*(\\#"+y+")[ \\t]*\\}{2}([\\s\\S]*?)\\{{2}[ \\t]*(\\/"+y+")[ \\t]*\\}{2}","g"),""))}else if("/"!==y[0]&&"^"!==y[0]){var b;"undefined"!=typeof d[y]?b=d[y]:"$index"===y?(y="\\"+y,b=s):"$value"===y&&(y="\\"+y,b=d),"string"==typeof b&&(b=b.replace(/<[^>]*>/g,"")),c=c.replace(new RegExp("\\{{2}[ \\t]*("+y+")[ \\t]*\\}{2}","g"),b)}}l.push(c)}e.innerHTML="";for(var g=0,h=l.length;h>g;g++)e.innerHTML+=l[g]},c=function(e,t){return e.setAttribute("class",t),e},s=function(e,t){return"textContent"in e?e.textContent=t:e.innerText=t,e},v=function(e,t){e.value=t},d=function(e,t){e.setAttribute("placeholder",t)},p=function(e){return"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName};return"undefined"!==t&&(e.Knity=r),"function"==typeof define&&define.amd&&define("knity",[],function(){return r}),"object"==typeof module&&module.exports&&(module.exports=r),r}("undefined"!=typeof window?window:void 0);